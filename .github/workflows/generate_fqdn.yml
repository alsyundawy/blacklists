name: Generate blacklist

on:
  # Runs on pushes targeting the default branch
  schedule:
    - cron: '0 * * * *'

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  Generate-Blacklist:
    runs-on: ubuntu-latest
    steps:
    - name: Setup Git Configurations
      run: |
        git config --global user.email "action@github.com"
        git config --global user.name "github-actions[bot]"

    - name: Check out repository code
      uses: actions/checkout@v2
      with:
        fetch-depth: 0  # Fetch all history for completeness
        ref: main
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Generate blacklist
      run: sudo /bin/bash generate_fqdn.sh

    - name: Commit and Push updated blacklist to repository
      run: |
        git add all.fqdn.blacklist.tar.gz 
        git commit -m "Updated blacklist."
        git push origin main
